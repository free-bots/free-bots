# Visit https://github.com/lowlighter/metrics#-documentation for full reference
name: Metrics
on:
  # Schedule updates (each hour)
  schedule: [{cron: "0 0/12 * * *"}]
  # Lines below let you run workflow manually and on each commit
  workflow_dispatch:
  push: {branches: ["master", "main"]}
jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v3
        with:
          path: repo
          sparse-checkout: |
            readme-builder
      - name: Install chrome dependencies
        # run: |
        #   sudo apt-get update
        #   sudo apt-get install -y libgconf-2-4 libatk1.0-0 libatk-bridge2.0-0 libgdk-pixbuf2.0-0 libgtk-3-0 libgbm-dev libnss3-dev libxss-dev libasound2
        run: |
          sudo apt-get update
          sudo apt-get install -y fonts-liberation libcairo2 libgbm1 libgtk-3-0 libpango-1.0-0 libxdamage1 libxkbcommon0 xdg-utils libu2f-udev
          CHROME_DOWNLOAD=google-chrome-stable_current_amd64.deb
          curl --no-progress-meter \
            --output /tmp/${CHROME_DOWNLOAD} \
            https://dl.google.com/linux/direct/${CHROME_DOWNLOAD}
          sudo apt-get install -y /tmp/${CHROME_DOWNLOAD}
          PUPPETEER_SKIP_DOWNLOAD=true
          PUPPETEER_EXECUTABLE_PATH=$(which google-chrome-stable)
      # - uses: browser-actions/setup-chrome@v1
      #   env:
      #     PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: "true"
      #     PUPPETEER_EXECUTABLE_PATH: ${{ steps.setup-chrome.outputs.chrome-path }}
      - uses: actions/setup-node@v3
        with:
          node-version: 18 
      - name: cd
        working-directory: repo
        run: |
          git status
          ls -alh
      # - uses: lowlighter/metrics@latest
      #   with:
      #     # Your GitHub token
      #     # The following scopes are required:
      #     #  - public_access (default scope)
      #     # The following additional scopes may be required:
      #     #  - read:org      (for organization related metrics)
      #     #  - read:user     (for user related data)
      #     #  - read:packages (for some packages related data)
      #     #  - repo          (optional, if you want to include private repositories)
      #     token: ${{ secrets.METRICS_TOKEN }}

      #     # Options
      #     user: free-bots
      #     template: classic
      #     base: activity, community
      #     config_timezone: Europe/Berlin
      #     plugin_achievements: yes
      #     plugin_achievements_display: compact
      #     plugin_achievements_secrets: yes
      #     plugin_achievements_threshold: C
      #     plugin_languages: yes
      #     plugin_languages_analysis_timeout: 15
      #     plugin_languages_categories: markup, programming
      #     plugin_languages_colors: github
      #     plugin_languages_details: bytes-size, lines
      #     plugin_languages_limit: 8
      #     plugin_languages_recent_categories: markup, programming
      #     plugin_languages_recent_days: 14
      #     plugin_languages_recent_load: 300
      #     plugin_languages_sections: most-used
      #     plugin_languages_threshold: 0%
      - name: build template
        working-directory: repo
        run: |
          git status
          cd ./readme-builder
          npm ci
          npm run start
          cd ..
          git status
      - name: modify
        working-directory: repo
        run: |
          pwd
          date > text.txt
          git status
      - uses: EndBug/add-and-commit@v9
        with:
          message: updated readme.webp
          add: readme.webp
          cwd: repo
          default_author: github_actions
